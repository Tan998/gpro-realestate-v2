function wpestate_handle_password_change(){const e=13,t="#oldpass, #newpass, #renewpass",s="#change_pass";jQuery(t).on("keydown",function(t){t.keyCode===e&&(t.preventDefault(),wpestate_change_pass_profile())}),jQuery(s).on("click",function(e){e.preventDefault(),wpestate_change_pass_profile()})}function wpestate_change_pass_profile(){"use strict";var e,t,s,r,a;e=jQuery("#oldpass").val(),t=jQuery("#newpass").val(),s=jQuery("#renewpass").val(),r=jQuery("#security-pass").val(),a=ajaxcalls_vars.admin_url+"admin-ajax.php",jQuery.ajax({type:"POST",url:a,data:{action:"wpestate_ajax_update_pass",oldpass:e,newpass:t,renewpass:s,"security-pass":r},success:function(e){jQuery("#profile_pass").empty().append('<div class="login-alert">'+e+"<div>"),jQuery("#oldpass, #newpass, #renewpass").val("")},error:function(e){}})}function wpestate_handle_social_login(){jQuery(".wpestate_social_login").on("click",function(e){e.preventDefault();var t=ajaxcalls_vars.admin_url+"admin-ajax.php",s=jQuery(this).attr("data-social"),r=jQuery(this).parent().find(".wpestate_social_login_nonce").val();jQuery.ajax({type:"POST",url:t,data:{action:"wpestate_social_login_generate_link",social_type:s,nonce:r},success:function(e){window.location.href=e},error:function(e,t,s){console.error("Social login error:",t,s),alert("An error occurred during social login. Please try again.")}})})}function wpestate_controls_show_hide_login_register_forgot_form(){jQuery(".wpestate_login_form_switch_login, .wpestate_login_form_switch_register, .wpestate_login_form_switch_forgot").on("click",function(e){e.preventDefault();var t=jQuery(this),s=t.parent().parent(),r=t.attr("class").split("_").pop();s.find(".wpestate_login_form_wrapper, .wpestate_register_form_wrapper, .wpestate_forgot_form_wrapper").hide(),s.find(".wpestate_login_form_switch_login, .wpestate_login_form_switch_register, .wpestate_login_form_switch_forgot").show(),s.find(".wpestate_"+r+"_form_wrapper").show().find("[autofocus]").focus(),t.hide()})}function wpestate_initializePasswordVisibilityToggle(){jQuery(".show_hide_password").on("click",function(){var e=jQuery(this).parent().find(":input");"password"===e.attr("type")?(e.attr("type","text"),jQuery(this).removeClass("fa-eye-slash").addClass("fa-eye")):(e.attr("type","password"),jQuery(this).removeClass("fa-eye").addClass("fa-eye-slash"))})}function wpestate_trigger_register_action(){const e=jQuery(document),t=13;e.on("click",".wpestate_register_submit_button",function(e){wpestate_register_user(jQuery(this))}),e.on("keydown",".wpestate_register_form_email, .wpestate_register_form_username, .wpestate_register_form_password, .wpestate_register_form_user_type",function(e){if(e.keyCode===t){e.preventDefault();const t=jQuery(this).closest(".wpestate_register_form_wrapper").find(".wpestate_register_submit_button");wpestate_register_user(t)}})}function getRecaptchaResponse(e){if("undefined"==typeof grecaptcha||!grecaptcha||"yes"!==control_vars.usecaptcha)return null;const t=e.querySelector(".wpestate_register_form_captcha");if(!t)return console.warn("reCAPTCHA element not found in the form"),null;const s=document.getElementsByClassName("wpestate_register_form_captcha"),r=Array.from(s).indexOf(t);if(-1===r||r>=widgetRecaptchas.length)return console.warn("Could not find corresponding widget ID for this reCAPTCHA"),null;const a=grecaptcha.getResponse(widgetRecaptchas[r]);return a||console.warn("reCAPTCHA response is empty"),a}function wpestate_register_user(e){"use strict";const t=e.closest(".wpestate_register_form_wrapper"),s=t.find(".wpestate_register_message_area"),r=wpestate_login_register_vars.admin_url+"admin-ajax.php";s.html('<div class="login-alert">'+wpestate_login_register_vars.procesing+"</div>");const a={user_login_register:t.find(".wpestate_register_form_usenmame").val(),user_email_register:t.find(".wpestate_register_form_email").val(),security_nonce:t.find(".wpestate_register_form_security").val(),user_pass:"yes"===ajaxcalls_vars.userpass?t.find(".wpestate_register_form_password").val():"",user_pass_retype:"yes"===ajaxcalls_vars.userpass?t.find(".wpestate_register_form_password_retype").val():"",new_user_type:t.find(".wpestate_register_form_user_type").length>0?t.find(".wpestate_register_form_user_type").val():""};if("yes"===control_vars.usecaptcha){const e=getRecaptchaResponse(t[0]);if("yes"===control_vars.use_captcha&&!e)return void s.html('<div class="login-alert">Please complete the reCAPTCHA.</div>');a.capthca=e}wpestate_validateRegistrationData(t,a)&&jQuery.ajax({type:"POST",dataType:"json",url:r,data:{action:"wpestate_to_register_user",...a,type:1},success:function(e){wpestate_handleRegistrationResponse(t,s,e)},error:function(e){console.error("Registration error:",e),s.html("<p>An error occurred during registration. Please try again.</p>")}})}function wpestate_validateRegistrationData(e,t){const s=e.find(".wpestate_register_message_area");return e.find(".wpestate_register_form_agree_terms").is(":checked")?!(0===t.new_user_type&&e.find(".wpestate_register_form_user_type").length>0)||(s.html(`<div class="login-alert">${control_vars.user_type_warn}</div>`),!1):(s.html(`<div class="login-alert">${control_vars.terms_cond}</div>`),!1)}function wpestate_handleRegistrationResponse(e,t,s){const r=s.message||s.data&&s.data.message||("string"==typeof s.data?s.data:"")||wpestate_login_register_vars.generic_register_error,a=!0===s.register||!0===s.success,o=a?"wpestate_success":"login-alert";t.html(`<div class="${o}">${r}</div>`),e.find('input[type="text"],input[type="email"], input[type="password"]').val(""),e.find("select").val(0),a&&setTimeout(()=>{e.parent().find(".wpestate_login_form_switch_login").trigger("click")},1500)}function wpestate_trigger_login_action(){const e=jQuery(document),t=13;e.on("click",".wpestate_login_submit_button",function(e){wpestate_login_user(jQuery(this))}),e.on("keydown",".wpestate_login_form_username, .wpestate_login_form_password",function(e){if(e.keyCode===t){e.preventDefault();const t=jQuery(this).closest(".wpestate_login_form_wrapper").find(".wpestate_login_submit_button");wpestate_login_user(t)}})}function wpestate_login_user(e){"use strict";const t=e.closest(".wpestate_login_form_wrapper"),s=t.find(".login_register_message_area"),r=wpestate_login_register_vars.admin_url+"admin-ajax.php";s.html('<div class="login-alert">'+wpestate_login_register_vars.login_loading+"</div>");const a={login_user:t.find(".wpestate_login_form_username").val(),login_pwd:t.find(".wpestate_login_form_password").val(),security_nonce:t.find(".wpestate_social_login_nonce").val(),ispop:t.find(".loginpop").val()||"0"};"3"===jQuery("#loginpop_submit").val()&&(ispop=3),wpestate_validateLoginData(t,a)&&jQuery.ajax({type:"POST",dataType:"json",url:r,data:{action:"wpestate_ajax_login_user",...a},success:function(e){wpestate_handleLoginResponse(t,s,e)},error:function(e,t,r){console.error("Login error:",e.responseText,t,r),s.html("<p>An error occurred during login. Please try again.</p>")}})}function wpestate_validateLoginData(e,t){return!(!t.login_user||!t.login_pwd)||(e.find(".login_register_message_area").html('<div class="login-alert">Please enter both username and password.</div>'),!1)}function wpestate_handleLoginResponse(e,t,s){s.loggedin;if(!0===s.loggedin?t.html(`<div class="wpestate_success">${s.message}</div>`):t.html(`<div class="login-alert">${s.message}</div>`),s.loggedin){if(1===parseInt(s.ispop,10)||3===parseInt(s.ispop,10)){ajaxcalls_vars.userid=s.newuser,jQuery("#login-modal_close").trigger("click");var r='<div class="menu_user_picture" style="background-image: url('+s.picture+')"></div>    <a class="navicon-button x"><div class="navicon"></div></a>';jQuery("#user_menu_u").append(r).addClass("user_loged"),jQuery(".submit_action").remove(),jQuery(".submit_listing").remove(),jQuery("#agent_property_ajax_nonce").val(s.nonce_contact),jQuery("#user_menu_u").after(s.menu.desktop),jQuery(".login_sidebar").hide(),jQuery(".mobilemenu-close-user").after(s.menu.mobile);var a='<div class="menu_user_picture" style="background-image: url('+s.picture+');"></div>';jQuery(".mobile-trigger-user").empty().append(a),wpestate_isMobileOrTablet()&&jQuery(".mobilemenu-close-user").trigger("click"),wpestate_open_menu()}else 2===parseInt(s.ispop,10)?location.reload():document.location.href=wpestate_login_register_vars.login_redirect;jQuery("#user_not_logged_in").hide(),jQuery("#user_logged_in").show()}else e.find(".wpestate_login_form_username").val(""),e.find(".wpestate_login_form_password").val("")}function wpestate_trigger_forgot_password_action(){const e=jQuery(document),t=13;e.on("click",".wpestate_forgot_password_submit_button",function(e){wpestate_forgot(jQuery(this))}),e.on("keydown",".wpestate_forgot_form_email",function(e){if(e.keyCode===t){e.preventDefault();const t=jQuery(this).closest(".wpestate_forgot_form_wrapper").find(".wpestate_forgot_password_submit_button");wpestate_forgot(t)}})}function wpestate_forgot(e){"use strict";const t=e.closest(".wpestate_forgot_form_wrapper"),s=t.find(".login_register_message_area"),r=wpestate_login_register_vars.admin_url+"admin-ajax.php";s.html('<div class="login-alert">'+wpestate_login_register_vars.procesing+"</div>");const a={forgot_email:t.find(".wpestate_forgot_form_email").val(),security_nonce:t.find(".wpestate_forgot_form_security").val(),postid:t.find("#postid").val()||""};wpestate_validateForgotPasswordData(t,a)&&jQuery.ajax({type:"POST",dataType:"json",url:r,data:{action:"wpestate_ajax_forgot_pass_user",...a},success:function(e){wpestate_handleForgotPasswordResponse(t,s,e)},error:function(e,t,r){console.error("Forgot password error:",t,r),s.html("<p>An error occurred. Please try again.</p>")}})}function wpestate_validateForgotPasswordData(e,t){return!!t.forgot_email||(e.find(".login_register_message_area").html(`<div class="login-alert">${wpestate_login_register_vars.forgot_warning}</div>`),!1)}function wpestate_handleForgotPasswordResponse(e,t,s){const r=!0===s.reset?"wpestate_success":"";e.find(".wpestate_forgot_form_email").val(""),t.html(`<div class="login-alert ${r}">${s.message}</div>`)}jQuery(document).ready(function(e){"use strict";jQuery("#login-modal_close").on("click",function(e){jQuery("#modal_login_wrapper").hide()}),wpestate_trigger_login_action(),wpestate_trigger_register_action(),wpestate_trigger_forgot_password_action(),wpestate_controls_show_hide_login_register_forgot_form(),wpestate_initializePasswordVisibilityToggle(),wpestate_handle_social_login(),wpestate_handle_password_change()});var widgetRecaptchas=[],wpestate_onloadCallback=function(){for(var e=document.getElementsByClassName("wpestate_register_form_captcha"),t=0;t<e.length;t++){var s=grecaptcha.render(e[t],{sitekey:control_vars.captchakey,theme:"light"});widgetRecaptchas.push(s)}};